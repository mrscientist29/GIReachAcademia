<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logo & Color Extraction Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; }
        .warning { border-left: 4px solid #f59e0b; }
        .error { border-left: 4px solid #ef4444; }
        .info { border-left: 4px solid #3b82f6; }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        
        .logo-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 10px 0;
        }
        .logo-icon {
            width: 48px;
            height: 48px;
            background: #3b82f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px;
            border: 2px solid #ddd;
        }
        .debug-log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .step {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîß Logo & Color Extraction Debug Test</h1>
    
    <div class="test-card info">
        <h2>üìã Test Instructions</h2>
        <div class="step">
            <strong>Step 1:</strong> Open browser console (F12) to see debug logs
        </div>
        <div class="step">
            <strong>Step 2:</strong> Go to <code>http://localhost:5000/admin/login</code>
        </div>
        <div class="step">
            <strong>Step 3:</strong> Login and navigate to Page Editor ‚Üí Logo Settings
        </div>
        <div class="step">
            <strong>Step 4:</strong> Upload a logo and watch console for debug messages
        </div>
        <div class="step">
            <strong>Step 5:</strong> Navigate between pages to test logo persistence
        </div>
    </div>

    <div class="test-card">
        <h2>üß™ Local Storage Tests</h2>
        <button onclick="testLogoStorage()">Test Logo Storage</button>
        <button onclick="testThemeStorage()">Test Theme Storage</button>
        <button onclick="clearStorage()">Clear All Storage</button>
        <div id="storageResults"></div>
    </div>

    <div class="test-card">
        <h2>üé® Color Extraction Test</h2>
        <p>Test color extraction with a sample image:</p>
        <button onclick="testColorExtraction()">Test Color Extraction</button>
        <div id="colorResults"></div>
    </div>

    <div class="test-card">
        <h2>üìä Current Settings</h2>
        <button onclick="showCurrentSettings()">Show Current Logo & Theme</button>
        <div id="currentSettings"></div>
    </div>

    <div class="test-card warning">
        <h2>üêõ Common Issues & Solutions</h2>
        <ul>
            <li><strong>Logo not persisting:</strong> Check if localStorage is working and events are firing</li>
            <li><strong>Color extraction failing:</strong> Check console for canvas/image loading errors</li>
            <li><strong>Theme not applying:</strong> Verify CSS custom properties are being set</li>
            <li><strong>Cross-page issues:</strong> Check if navigation component is listening for updates</li>
        </ul>
    </div>

    <div class="test-card">
        <h2>üìù Debug Log</h2>
        <div id="debugLog" class="debug-log">
            Debug messages will appear here...
        </div>
    </div>

    <script>
        let debugLog = document.getElementById('debugLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            console.log(logEntry);
            debugLog.innerHTML += logEntry + '\n';
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        function testLogoStorage() {
            log('Testing logo storage...', 'info');
            const results = document.getElementById('storageResults');
            
            try {
                // Test logo settings
                const testLogo = {
                    type: 'icon',
                    iconName: 'Stethoscope',
                    iconColor: 'text-white',
                    iconBackground: 'bg-blue-600',
                    primaryText: 'TEST LOGO',
                    secondaryText: 'Debug Mode',
                    showSecondaryText: true
                };
                
                localStorage.setItem('gireach-logo', JSON.stringify(testLogo));
                const retrieved = JSON.parse(localStorage.getItem('gireach-logo'));
                
                if (retrieved.primaryText === 'TEST LOGO') {
                    results.innerHTML = '<div class="success">‚úÖ Logo storage working correctly!</div>';
                    log('Logo storage test passed', 'success');
                } else {
                    results.innerHTML = '<div class="error">‚ùå Logo storage failed</div>';
                    log('Logo storage test failed', 'error');
                }
                
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                log(`Logo storage error: ${error.message}`, 'error');
            }
        }

        function testThemeStorage() {
            log('Testing theme storage...', 'info');
            const results = document.getElementById('storageResults');
            
            try {
                const testTheme = {
                    colors: {
                        primary: '#ff0000',
                        secondary: '#00ff00',
                        accent: '#0000ff',
                        background: '#ffffff',
                        text: '#000000',
                        muted: '#666666'
                    }
                };
                
                localStorage.setItem('gireach-theme', JSON.stringify(testTheme));
                const retrieved = JSON.parse(localStorage.getItem('gireach-theme'));
                
                if (retrieved.colors.primary === '#ff0000') {
                    results.innerHTML += '<div class="success">‚úÖ Theme storage working correctly!</div>';
                    log('Theme storage test passed', 'success');
                } else {
                    results.innerHTML += '<div class="error">‚ùå Theme storage failed</div>';
                    log('Theme storage test failed', 'error');
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
                log(`Theme storage error: ${error.message}`, 'error');
            }
        }

        function clearStorage() {
            localStorage.removeItem('gireach-logo');
            localStorage.removeItem('gireach-theme');
            localStorage.removeItem('gireach-content');
            document.getElementById('storageResults').innerHTML = '<div class="info">üßπ Storage cleared</div>';
            log('All storage cleared', 'info');
        }

        function testColorExtraction() {
            log('Testing color extraction...', 'info');
            const results = document.getElementById('colorResults');
            
            // Create a test canvas with colored pixels
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            
            // Draw some colored rectangles
            ctx.fillStyle = '#1e3a8a'; // Navy blue
            ctx.fillRect(0, 0, 50, 50);
            
            ctx.fillStyle = '#06b6d4'; // Cyan
            ctx.fillRect(50, 0, 50, 50);
            
            ctx.fillStyle = '#ff6b6b'; // Coral
            ctx.fillRect(0, 50, 50, 50);
            
            ctx.fillStyle = '#f5f5dc'; // Beige
            ctx.fillRect(50, 50, 50, 50);
            
            // Convert to data URL
            const dataUrl = canvas.toDataURL();
            
            // Test the extraction (simplified version)
            const imageData = ctx.getImageData(0, 0, 100, 100);
            const data = imageData.data;
            
            let colors = [];
            for (let i = 0; i < data.length; i += 16) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const a = data[i + 3];
                
                if (a > 128) {
                    const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
                    if (!colors.includes(hex)) {
                        colors.push(hex);
                    }
                }
            }
            
            results.innerHTML = `
                <div class="success">‚úÖ Color extraction test completed!</div>
                <p>Extracted colors:</p>
                <div>
                    ${colors.map(color => `<span class="color-swatch" style="background: ${color}" title="${color}"></span>`).join('')}
                </div>
                <p>Colors found: ${colors.join(', ')}</p>
            `;
            
            log(`Color extraction test completed. Found ${colors.length} colors: ${colors.join(', ')}`, 'success');
        }

        function showCurrentSettings() {
            log('Showing current settings...', 'info');
            const results = document.getElementById('currentSettings');
            
            try {
                const logoSettings = localStorage.getItem('gireach-logo');
                const themeSettings = localStorage.getItem('gireach-theme');
                
                let html = '<h3>Current Logo Settings:</h3>';
                if (logoSettings) {
                    const logo = JSON.parse(logoSettings);
                    html += `
                        <div class="logo-preview">
                            <div class="logo-icon">${logo.primaryText ? logo.primaryText.charAt(0) : '?'}</div>
                            <div>
                                <strong>${logo.primaryText || 'No text'}</strong><br>
                                <small>${logo.secondaryText || 'No tagline'}</small><br>
                                <small>Type: ${logo.type || 'unknown'}</small>
                            </div>
                        </div>
                    `;
                } else {
                    html += '<p>No logo settings found</p>';
                }
                
                html += '<h3>Current Theme Settings:</h3>';
                if (themeSettings) {
                    const theme = JSON.parse(themeSettings);
                    if (theme.colors) {
                        html += '<div>';
                        Object.entries(theme.colors).forEach(([key, value]) => {
                            html += `<span class="color-swatch" style="background: ${value}" title="${key}: ${value}"></span>`;
                        });
                        html += '</div>';
                        html += `<p>Primary: ${theme.colors.primary}, Accent: ${theme.colors.accent}</p>`;
                    }
                } else {
                    html += '<p>No theme settings found</p>';
                }
                
                results.innerHTML = html;
                log('Current settings displayed', 'info');
                
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Error reading settings: ${error.message}</div>`;
                log(`Error reading settings: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            log('Debug test page loaded', 'info');
            log('Ready to test logo persistence and color extraction', 'info');
            log('Open admin panel at: http://localhost:5000/admin/login', 'info');
            log('Login: admin@gireach.pk / admin123', 'info');
        };

        // Listen for storage events
        window.addEventListener('storage', function(e) {
            if (e.key === 'gireach-logo') {
                log('Logo storage changed detected!', 'success');
            }
            if (e.key === 'gireach-theme') {
                log('Theme storage changed detected!', 'success');
            }
        });

        // Listen for custom events
        window.addEventListener('logoUpdated', function(e) {
            log('Logo updated event received!', 'success');
        });
    </script>
</body>
</html>